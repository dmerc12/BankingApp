{% extends "templates/Layout.html" %}

{% block title %}Updating Your Information{% endblock %}

{% block loginOrLogout %}
<div class="navbar-nav">
    <a id="navLogoutButton" class="nav-item nav-link" href="{{ url_for('new_logout.logout') }}">Logout</a>
</div>
{% endblock %}

{% block main %}

<div class="container">
    <div class="col">
        <h1>Update Current Information</h1>
        <hr>

        <form method="POST">
            <div class="form-group">
                <label for="updatedFirstName">First Name: </label>
                <input type="text" class="form-control" name="updatedFirstName" id="updatedFirstName" value="{{ current_customer.first_name }}" required>
            </div>

            <div class="form-group">
                <label for="updatedLastName">Last Name: </label>
                <input type="text" class="form-control" name="updatedLastName" id="updatedLastName" value="{{ current_customer.last_name }}" required>
            </div>

            <div class="form-group">
                <label for="updatedEmail">Email: </label>
                <input type="email" class="form-control" name="updatedEmail" id="updatedEmail" value="{{ current_customer.email }}" required>
            </div>

            <div class="form-group">
                <label for="updatedPhoneNumber">Phone Number: </label>
                <input type="text" class="form-control" name="updatedPhoneNumber" id="updatedPhoneNumber" value="{{ current_customer.phone_number }}" oninput="formatPhoneNumber(this)" required>
            </div>

            <div class="form-group">
                <label for="updatedStreetAddress">Street Address: </label>
                <input type="text" class="form-control" name="updatedStreetAddress" id="updatedStreetAddress" required>
            </div>

            <div class="form-group">
                <label for="updatedCity">City: </label>
                <input type="text" class="form-control" name="updatedCity" id="updatedCity" required>
            </div>

            <div class="form-group">
                <label for="updatedState">State: </label>
                <select name="updatedState" id="updatedState" class="form-control" required>
                    {% for state in states %}
                        <option value="{{ state.code }}">{{ state.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="updatedZipCode">Zip Code: </label>
                <select name="updatedZipCode" id="updatedZipCode" class="form-control" required>
                    <option value="">Select a State First</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Update Information</button>
        </form>
        <script>
            function formatPhoneNumber(input) {
                var phoneNumber = input.value.replace(/\D/g, '');

                if (phoneNumber.length >= 7) {
                    phoneNumber = phoneNumber.replace(/^(\d{3})(\d{3})(\d{0,4}).*/, '$1-$2-$3');
                } else if (phoneNumber.length >= 4) {
                    phoneNumber = phoneNumber.replace(/^(\d{3})(\d{1,3}).*/, '$1-$2');
                } else if (phoneNumber.length >= 1) {
                    phoneNumber = phoneNumber.replace(/^(\d{1,3})/, '$1');
                }

                input.value = phoneNumber;
                return input;
            }

            function updateZipCodes() {
                var stateDropdown = document.getElementById("updatedState");
                var zipCodeDropdown = document.getElementById("updatedZipCode");
                var selectedState = stateDropdown.value;
                var zipCodes = {{ zip_codes|tojson }};

                if (selectedState && zipCodes.hasOwnProperty(selectedState)) {
                    zipCodeDropdown.innerHTML = "";
                    var selectedStateZipCodes = zipCodes[selectedState];
                    for (var i = 0; i < selectedStateZipCodes.length; i++) {
                        var zipCode = selectedStateZipCodes[i];
                        var option = document.createElement("option");
                        option.value = zipCode;
                        option.text = zipCode;
                        zipCodeDropdown.appendChild(option);
                    }
                }
            }

            var stateDropdown = document.getElementById("updatedState");
            stateDropdown.addEventListener("change", updateZipCodes);

            updateZipCodes();
        </script>
    </div>
</div>

{% endblock %}